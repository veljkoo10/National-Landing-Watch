<div id="map"></div>

<!-- Left Sidebar Button -->
<div class="map-overlay">
  <button (click)="toggleSidebar()">
    <mat-icon>menu</mat-icon>
  </button>
</div>

<div class="map-right-sidebar">
  <!-- Map Type (inline, one row) -->
  <div class="map-mode-inline">
    <label class="map-type-inline-label">
      <mat-icon>layers</mat-icon>
      <span>Map Type:</span>
    </label>

    <div
      class="map-type-inline-dropdown"
      (click)="toggleMapTypeDropdown()"
      [class.open]="isDropdownOpen"
      tabindex="0"
    >
      <mat-icon *ngIf="mapType === 'satellite'">satellite_alt</mat-icon>
      <mat-icon *ngIf="mapType === 'heatmap'">local_fire_department</mat-icon>
      <span>{{ mapType === 'satellite' ? 'Satellite' : 'Heatmap' }}</span>
      <mat-icon class="arrow">{{ isDropdownOpen ? 'expand_less' : 'expand_more' }}</mat-icon>

      <!-- Dropdown menu -->
      <div class="inline-dropdown-menu" *ngIf="isDropdownOpen">
        <div
          class="inline-dropdown-option"
          (click)="setMapType('satellite'); $event.stopPropagation()"
        >
          <mat-icon>satellite_alt</mat-icon>
          <span>Satellite</span>
        </div>
        <div
          class="inline-dropdown-option"
          (click)="setMapType('heatmap'); $event.stopPropagation()"
        >
          <mat-icon>local_fire_department</mat-icon>
          <span>Heatmap</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Region Selector -->
  <div class="region-selector-section">
    <label for="regionSelect" class="region-label">
      {{ 'map.overlay.selectRegion' | translate }}
    </label>
    <select id="regionSelect" (change)="onRegionSelect($event)" class="region-dropdown">
      <option value="" disabled selected hidden>
        {{ 'map.overlay.selectRegion' | translate }}
      </option>
      <option *ngFor="let region of regionKeys" [value]="region">
        {{ regionDisplayNames[region] }}
      </option>
    </select>
  </div>

  <!-- Empty state (shown before any region is selected) -->
  <div class="empty-state-card" *ngIf="!selectedRegionData">
    <mat-icon>explore</mat-icon>
    <h4>{{ 'map.empty.selectTitle' | translate }}</h4>
    <p>{{ 'map.empty.selectSubtitle' | translate }}</p>
  </div>

  <hr *ngIf="selectedRegionData" />

  <!-- Region Details -->
  <div class="sidebar-section region-details" *ngIf="selectedRegionData as region">
    <h3>{{ region.name }}</h3>

    <p class="info-item">
      <strong>
        {{ 'map.region.population' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, populationTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #populationTooltip style="display: none">
            {{ 'map.tooltip.population' | translate }}
          </span> </span
        >:
      </strong>
      {{ region.population | number }}
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.region.area' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, areaTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #areaTooltip style="display: none">
            {{ 'map.tooltip.area' | translate }}
          </span> </span
        >:
      </strong>
      {{ region.areaKm2 | number }} km²
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.region.landfills' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, landfillsTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #landfillsTooltip style="display: none">
            {{ 'map.tooltip.landfills' | translate }}
          </span> </span
        >:
      </strong>
      {{ region.landfillCount }}
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.region.totalWaste' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, totalWasteTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #totalWasteTooltip style="display: none">
            {{ 'map.tooltip.totalWaste' | translate }}
          </span> </span
        >:
      </strong>
      {{ region.totalWaste | number }} t
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.region.wastePerCapita' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, wastePerCapitaTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #wastePerCapitaTooltip style="display: none">
            {{ 'map.tooltip.wastePerCapita' | translate }}
          </span> </span
        >:
      </strong>
      {{ region.totalWaste / region.population | number : '1.2-2' }}
      {{ 'map.region.measure' | translate }}
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.region.ch4' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, ch4Tooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #ch4Tooltip style="display: none">{{ 'map.tooltip.ch4' | translate }}</span> </span
        >:
      </strong>
      {{ region.ch4Tons | number }} t
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.region.co2' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, co2Tooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #co2Tooltip style="display: none">{{ 'map.tooltip.co2' | translate }}</span> </span
        >:
      </strong>
      {{ region.co2Tons | number }} t
    </p>

    <p>
      <strong>{{ 'map.region.pollutionLevel' | translate }}:</strong>
      <span [ngClass]="region.pollutionLevel">
        {{ 'map.pollution.' + region.pollutionLevel | translate }}
      </span>
    </p>
  </div>

  <!-- Landfill Details -->
  <div class="sidebar-section landfill-details" *ngIf="selectedLandfill">
    <h3>{{ 'map.landfill.id' | translate }}: {{ selectedLandfill.id }}</h3>

    <p class="info-item">
      <strong>{{ 'map.landfill.type' | translate }}:</strong>
      {{ getLandfillCategoryString(selectedLandfill.category) }}
    </p>

    <p class="info-item">
      <strong>{{ 'map.landfill.size' | translate }}:</strong>
      <span [style.color]="getLandfillSizeInfo(selectedLandfill.estimatedAreaM2!).color">
        {{ getLandfillSizeInfo(selectedLandfill.estimatedAreaM2!).label }}
      </span>
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.landfill.yearCreated' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, yearCreatedTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #yearCreatedTooltip style="display: none">
            {{ 'map.tooltip.landfill.yearCreated' | translate }}
          </span> </span
        >:
      </strong>
      {{ selectedLandfill.startYear || 2022 }}
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.landfill.yearMeasured' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, yearMeasuredTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #yearMeasuredTooltip style="display: none">
            {{ 'map.tooltip.landfill.yearMeasured' | translate }}
          </span> </span
        >:
      </strong>
      {{ 2025 }}
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.landfill.area' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, landfillAreaTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #landfillAreaTooltip style="display: none">
            {{ 'map.tooltip.landfill.area' | translate }}
          </span> </span
        >:
      </strong>
      {{ selectedLandfill.estimatedAreaM2 | number }} m²
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.landfill.volume' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, landfillVolumeTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #landfillVolumeTooltip style="display: none">
            {{ 'map.tooltip.landfill.volume' | translate }}
          </span> </span
        >:
      </strong>
      {{ selectedLandfill.estimatedVolumeM3 | number }} m³
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.landfill.waste' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, landfillWasteTooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #landfillWasteTooltip style="display: none">
            {{ 'map.tooltip.landfill.waste' | translate }}
          </span> </span
        >:
      </strong>
      {{ selectedLandfill.estimatedCH4Tons | number }} t
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.landfill.ch4' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, landfillCh4Tooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #landfillCh4Tooltip style="display: none">
            {{ 'map.tooltip.landfill.ch4' | translate }}
          </span> </span
        >:
      </strong>
      {{ selectedLandfill.estimatedCH4Tons | number }} t
    </p>

    <p class="info-item">
      <strong>
        {{ 'map.landfill.co2' | translate }}
        <span
          class="tooltip-container"
          (mouseenter)="showTooltip($event, landfillCo2Tooltip.textContent)"
          (mouseleave)="hideTooltip()"
        >
          <mat-icon class="tooltip-icon">info_outline</mat-icon>
          <span #landfillCo2Tooltip style="display: none">
            {{ 'map.tooltip.landfill.co2' | translate }}
          </span> </span
        >:
      </strong>
      {{ selectedLandfill.estimatedCO2eTons | number }} t
    </p>
  </div>
</div>

<!-- Bottom Landfill Cards -->
<div class="landfill-cards-container" *ngIf="selectedLandfills.length > 0">
  <div class="landfill-cards-scroll" (mousemove)="onCardsMouseMove($event)">
    <div
      class="landfill-card"
      *ngFor="let lf of selectedLandfills"
      (click)="onLandfillClick(lf)"
      (mouseenter)="hoveredCard = lf.id"
      (mouseleave)="hoveredCard = null"
      [class.hovered]="hoveredCard === lf.id"
    >
      <h4>{{ 'map.landfill.id' | translate }}: {{ lf.id }}</h4>
      <p>
        <strong>{{ 'map.landfill.type' | translate }}:</strong>
        {{ getLandfillCategoryString(lf.category) }}
      </p>
      <p>
        <strong>{{ 'map.landfill.size' | translate }}:</strong>
        <span [style.color]="getLandfillSizeInfo(lf.estimatedAreaM2!).color">
          {{ getLandfillSizeInfo(lf.estimatedAreaM2!).label }}
        </span>
      </p>
      <p>
        <strong>{{ 'map.landfill.coords' | translate }}:</strong>
        {{ lf.pointLat?.toFixed(5) }}, {{ lf.pointLon?.toFixed(5) }}
      </p>
    </div>
  </div>
</div>

<!-- Floating Tooltip -->
<div
  class="custom-tooltip"
  *ngIf="tooltipText"
  [style.left.px]="tooltipPosition.x"
  [style.top.px]="tooltipPosition.y"
>
  {{ tooltipText }}
</div>
