# ============================
# 游댳 Baza: NVIDIA CUDA 12.1 + cuDNN8 (Ubuntu 22.04)
# ============================
FROM nvidia/cuda:12.1.0-cudnn8-runtime-ubuntu22.04

# Onemogu캖i interaktivne promptove (za apt)
ENV DEBIAN_FRONTEND=noninteractive

# ============================
# 游댳 OS paketi i sistemske biblioteke
# ============================
RUN apt-get update && apt-get install -y \
    python3 python3-pip git wget nano unzip \
    libgl1 libglib2.0-0 libsm6 libxext6 libxrender1 \
    && rm -rf /var/lib/apt/lists/*

# ============================
# 游댳 Radni direktorijum
# ============================
WORKDIR /app

# ============================
# 游댳 Kopiranje requirements fajla (ako postoji)
# ============================
COPY requirements.txt .

# ============================
# 游댳 Instalacija Pythona i zavisnosti
# ============================
RUN pip install --upgrade pip

# PyTorch sa CUDA 12.1 buildom
RUN pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# YOLOv8 + alati
RUN pip install ultralytics opencv-python-headless matplotlib pandas seaborn tqdm

# Ako koristi코 jo코 ne코to u requirements.txt
RUN if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

# ============================
# 游댳 Kopiranje tvog koda u kontejner
# ============================
COPY . .

# ============================
# 游댳 Default CMD (mo쬰코 menjati prilikom compose up)
# ============================
CMD ["python3", "src/train_seg.py"]
